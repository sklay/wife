<!DOCTYPE html>
<html>

	<head>
		<meta charset=" utf-8">
		<title>九宫格</title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
			}
			
			.box {
				width: 320px;
				height: 320px;
				/*background: #999;*/
				padding-top: 60px;
				padding-left: 60px;
			}
			
			.box li {
				float: left;
				list-style: none
			}
			
			.box li a {
				border: 5px solid #aaa;
				display: block;
				width: 100px;
				height: 100px;
				text-decoration: none;
				margin: 0 0 -5px -5px;
				position: relative;
				z-index: 0;
				text-align: center;
				line-height: 60px;
				color: #fff;
				font-size: 30px;
			}
			
			.box li a:hover {
				border: 5px solid #333;
				z-index: 1;
			}
			
			.freak{
				background: #000018;
			}
			.normal{
				background: #869791;
			}
		</style>
	</head>

	<body>
		<ul class="box">
		</ul>
	</body>
	<script type="text/javascript" src="js/jquery-2.2.0.min.js"></script>
	<script type="text/javascript" src="artTemplate/template.js" ></script>
	<script>
		var tiles = [
			[0, 1, 2],
			[3, 4, 5],
			[6, 7, 8]
		];

		$(function() {
			var maxRow = 3;
			var maxCol = 3;
			var positions = [];
			var posOrigs = [] ;
			/**行*/
			for(var row = 0; row < maxRow; row++) {
				/**列*/
				for(var col = 0; col < maxCol; col++) {
					posOrigs.push(row + '-' + col);
				}
			}
			
			for(var i = 0; i < (maxRow * maxCol - 1 ); i++) {
				positions.push(i+1);
			}
			positions.sort(function() {
				return 0.5 - Math.random()
			});
			console.debug(positions.join(','));
			
//			var backPoint = positions[parseInt(Math.random() * positions.length)] ;
			
		//	console.debug(" back is ," ,backPoint);
			var rows = [] ;
			for(var point = 0 ;point < (positions.length + 1) ;point++){
				
				var css = ((point+1) == positions.length+1) ? 'freak' : "normal" ;
			
				var rowPoint = {} ;
				rowPoint.original = posOrigs[point] ;
				rowPoint.css = css ;
				rowPoint.data = ((point+1) == positions.length+1) ? '' : positions[point] ;
				rows.push(rowPoint) ;
			}
//			template.config('escape', false) ;
			var gridRows = template('game-tpl',{'rows': rows || []}) ;	
			    	
			$('ul.box').html(gridRows) ;
			
			$('ul.box li').on('click',function(){
				var $this = $(this);
				var $normal = $this.find('a.normal') ;
				console.debug('click $normal' , $normal.length) ;
				if($normal && $normal.length == 0)
					return  ;
				
				var $clone = $normal.clone(false) ;
				var $parent = $normal.parent();
				var $original = $parent.attr('data-original') ;
				var $grid = $original.split('-') ;
				var $x = parseInt($grid[0]) ;
				var $y = parseInt($grid[1]) ;


				var $freak = $('ul.box li a.freak') ;
				var $freakClone = $freak.clone(false) ;
				var $freakParent = $freak.parent();
				var $freakOriginal = $freakParent.attr('data-original') ;
				var $freakGrid = $freakOriginal.split('-') ;

				var $freakX = parseInt($freakGrid[0]) ;
				var $freakY = parseInt($freakGrid[1]) ;
				
				var differX = Math.abs($x - $freakX) ;
				var differY = Math.abs($y - $freakY) ;
				
				console.debug(' original ' , $original , " , freakOriginal ," ,$freakOriginal , ' , differX ,' , differX , ',  $differY' , differY) ;
				
				if(1 == (differX + differY)){
					console.debug("交换") ;
					$parent.html($freakClone) ;
					$freakParent.html($clone) ;
				}
			}) ;
			
		});
	</script>
<script type="text/template" id="game-tpl">
	{{each rows as row i }}
	<li data-original="{{row.original }}">
		<a href="javascript:void(0);" data-current="{{row.data }}" class="{{row.css }}" >{{row.data }}</a>
	</li>
	{{/each}}
</script>
</html>