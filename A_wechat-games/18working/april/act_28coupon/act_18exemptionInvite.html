<!--<%@ page contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>-->
<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>送您一张28元无敌免单券</title>
		<meta name="description" content="春季防敏防霾 “罩”护你健康">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="format-detection" content="telephone=no, email=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<link rel="stylesheet" href="style/act_18allergyIndex.css" />
		<script src="js/jquery-2.2.0.min.js"></script>
		<script src="js/html_common.js"></script>
		<script>
			/** 默认是生产APPID*/
			var appid = 'wx697be0ec43c8cafa';
			var codeActId = '${code_act_id}' || '';
			var act_url = '${act_url}' || '' ;
			// 新追加一个参数
			var redirect_uri = 'http%3a%2f%2f' + location.host + '%2fmedhtml%2fcommon%2factivity%2f'+codeActId+'%3fact_url=' + act_url;
			console.debug(' cur href is ', redirect_uri);
			
		</script>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
			}
			
			html {
				font-size: 62.5%;
			}
			
			body {
				width: 100%;
				font-size: 10px;
				font-size: .1rem;
				font-family: Microsoft Yahei, Arial;
				background: #f1f2f6;
			}
			.indexPage {
			    width: 100%;
			    background: url(images/act_18exemptionInvite_bj1.jpg)center center ;
			    background-size: 100% 100%;
			}
			/*.activeRuleShowWrap {
			    width: 100%;
			    background: url(images/act_18allergyIndex_bbj.jpg)center center ;
			    background-size: 100% 100%;
			}*/
			.content_top {
			    margin: 0 auto;
			}
			.getHbWrap{
				width: 5.8rem;
				background: #fff;
				margin:  0 auto;
				/*padding:.2456rem 0;
				box-sizing: border-box;*/
				font-size: .2rem;
				text-align: center;
				border-radius: 8px;
				box-shadow: 0px 0px 15px #0c66b2;
				position: relative;
				z-index: 1;
				margin-top: -.8rem;
			}
			.getHbWrap h3{
				box-sizing: border-box;
				padding: .25rem 0;
			}
			#userPhone{
				border-radius: 15px;
			    border: 2px solid #16773a;
			    color: #737373;
			}
			::-moz-placeholder {
				color: #737373;
				text-align: center;
				font-family: ""
			}
			
			:-ms-input-placeholder {
				color: #737373;
				text-align: center;
			}
			
			::-webkit-input-placeholder {
				color: #737373;
				text-align: center;
			}
			#getHbBtn{
				width: 2.5rem;
			    background: #41a7fe;
			    box-shadow: 0 5px 5px #0c66b2,0 6px 5px #d5bcbc;
    			/*box-shadow:inset 0px -5px 4px #0c66b2,0px 5px 0px #d3b8b84a;*/
    			color:#fff;
    			font-weight: bold;
			}
			.comShowTitle , .userFriInf strong ,.userFriInf p{
				color:#21471e;
				padding-top:0 ;
				width: 4.6rem;
			}
			.comshowTitleText{
				width: 2rem;
			}
			.leftLineDot{
				padding-right: 0;
				margin-left: .2rem;
			}
			.leftLineDot span ,.rightLineDot span {
			    background: #21471e;
			}
			.rightLineDot span:nth-child(1){
				top: 19px;
			}
			.friHbShow{
				border-bottom: 1px dashed #21471e;
			}
			.userFriHbValue_wrap{
			    background: url(images/act_17laborDay_icon.png) 0px 0 no-repeat;
    			background-size: 100% 100%;
			}
			.pText{
				color:#0e4821;
			}
			.receiveResult{
				color:#fff;
				font-weight: 500;
			}
			
			/*.commUsebtn {
				padding: .5rem 0;
				box-sizing: border-box;
			}
			.commUsebtn button{
				width:2.4rem;
			    border-radius: 8px;
			    border: 2px solid #fff;
			    line-height: 38px;
    			height: 40px;
			}*/
			/*.getHbnNum, .has_over {
			    margin: 0rem auto 0;
			}
			.use_btn{
				background: #468147;
    			color:#fff;
    			box-shadow: 0 3px 3px #b11516;
			}*/
			.friHbShowWrap {
				margin-top: .2rem;
			}
			.friHbShow{
				border-bottom:0;
				width: 4.8rem;
			}
			.userFriAvatat{
				width: 100%;
				text-align: center;
				height: .8rem;
				line-height: .8rem;
			}
			/*.userFriAvatat p{
				float: left;
			}*/
			.friHbShowWrap ,.activeRuleShowWrap {
				background: #fff;
			}
			.commUsebtn button.shareFri{
				background: #dcc865;
    			color:#934b01;
			    box-shadow: 0 3px 3px #b11516;
			}
			.shareAppPage {
				display: block;
				width: 2.6rem;
				overflow: hidden;
				 padding: .5rem 0;
				box-sizing: border-box;
				margin: 0rem auto ;
				}
			
			.shareAppPage img {
				  width: 1rem;
				 
				  margin: 0 auto;
				  display: block;
				  outline: none;
				  border: none;
			}
			
			.shareAppPage img:nth-child(1) {
				float: left;
			}
			
			.shareAppPage img:nth-child(2) {
				float: right;
			}
			.getHbnNum{
				width: 100%;
			}
			
		</style>
	</head>
	<script>
		var _hmt = _hmt || [];
		(function() {
			var hm = document.createElement("script");
			hm.src = "//hm.baidu.com/hm.js?ad944074f96dc318a2bb2265b8eb4c31";
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(hm, s);
		})();
	</script>

	<body>
		<div class="content">
			<div class="indexPage">
				<div class="content_top">
					<img src="images/act_18exemptionInvite_logo.png" />
					<img src="images/act_18exemptionInvite_theme_1.png" />
				</div>
				<div class="getHbWrap">
					<div class="getHb">
						<div class="operateCon">
							<h3>分享免单，健康接力！ </h3>
							<p>给好友送28元免单券，TA免你也得</p>
						</div>
						<!--<div class="commomLogin" style="display: none;">
							<input type="tel" placeholder="请输入手机号码" id="userPhone">
							<button id="getHbBtn">免费领取</button>
						</div>-->
						<!--<div class="received_result" style="display: block;">-->
							<!--<div class="receive_success" style="display: block;">
								<div class=" getHbnNum">
	                   				<img  src="images/act_18allergyIndex_getSucc.png" alt="" />
								</div>
							</div>
							<div class="has_received" style="display: none;">
								<div class=" getHbnNum">
									<img  src="images/act_18allergyIndex_getFail.png" alt="" />
								</div>
							</div>
							<div class="empty" style="display: none;">
								<div class=" getHbnNum">
									<img  src="images/act_18allergyIndex_getFail.png" alt="" />
								</div>
							</div>-->
							<!--<div class="commUsebtn clearfix">
								<button class="use_btn goForUse" id="goForUse">下载APP</button>
								<button class="shareFri shareForFri" id="small_ShareFri">邀请好友领</button>
							</div>-->
							<div class="shareAppPage commUsebtn clearfix">
								<!--<button class="shareAppBtn" id="shareAppPage_shareFir">分享给好友</button>
								<button class="shareAppBtn" id="shareAppPage_friRound">分享到朋友圈</button>-->
								<img class="shareAppBtn" id="shareAppPage_shareFir" src="images/act_18exemptionInvite_shareTofriBtn.png" />
								<img class="shareAppBtn" id="shareAppPage_friRound" src="images/aact_18exemptionInvite_shareToFritoundBtn.png" />
						</div>
						<!--</div>-->
					</div>
				</div>
			</div>
			
			<!--看朋友手气 start-->
			<!--<c:if test="${ not empty coupList }">
			<div class="friHbShowWrap ">
				<div class="comShowTitle">
					<div class="leftLineDot">
						<span style="height: 1px; width: 1.4rem;"></span> <span style="width: 6px; height: 6px; transform: rotate(40deg); -o-transform: rotate(40deg); -webkit-transform: rotate(40deg); -moz-transform: rotate(40deg);"></span>
					</div>
					<div class="comshowTitleText">看看朋友的手气</div>
					<div class="rightLineDot">
						<span style="width: 6px; height: 6px; transform: rotate(40deg); -o-transform: rotate(40deg); -webkit-transform: rotate(40deg); -moz-transform: rotate(40deg);"></span> <span style="height: 1px; width: 1.4rem;"></span>
					</div>
				</div>
				<c:forEach var="rc" items="${coupList}" varStatus="status">
					<div class="friHbShow">
						<div class="userFriAvatat">
							<c:if test="${ not empty rc.headimgurl }">
								<img src="${rc.headimgurl }" alt="头像" />
							</c:if>
							<c:if test="${ empty rc.headimgurl }">
								<img src="images/act_commonHead_img.jpg" alt="头像" />
							</c:if>
							<div class="userFriInf">
								<strong>${rc.nickname } </strong>
								<c:if test="${700 == rc.couponValue}">
									<p>人品爆发，这波福利我收啦!</p>
								</c:if>
								<c:if test="${800 == rc.couponValue}">
									<p>又给这么大红包，药快到太给力啦!</p>
								</c:if>
							</div>
						</div>
						<div class="userFriInf_wrap">
							<c:if test="${700 == rc.couponValue}">
								<div class="userFriHbValue_wrap">
									<span class="userFriHbValue">7<span>元</span></span>
								</div>
							</c:if>
							<c:if test="${800 == rc.couponValue}">
								<div class="userFriHbValue_wrap">
									<span class="userFriHbValue">8<span>元</span></span>
								</div>
							</c:if>
						</div>
					</div>
				</c:forEach>
			</div>
		</c:if>-->
		<div class="friHbShowWrap ">
				<div class="comShowTitle">
					<div class="leftLineDot">
						<span style="height: 1px; width: 1rem;"></span> 
						<!--<span style="width: 6px; height: 6px; transform: rotate(40deg); -o-transform: rotate(40deg); -webkit-transform: rotate(40deg); -moz-transform: rotate(40deg);"></span>-->
					</div>
					<div class="comshowTitleText">已获赠券</div>
					<div class="rightLineDot">
						<!--<span style="width: 6px; height: 6px; transform: rotate(40deg); -o-transform: rotate(40deg); -webkit-transform: rotate(40deg); -moz-transform: rotate(40deg);"></span>--> 
						<span style="height: 1px; width: 1rem;"></span>
					</div>
				</div>
				<div class="friHbShow">
					<div class="userFriAvatat">
						<div class="userFriInf">
							<p>您的好友小明领取了一张28元免单券</p>
						</div>
					</div>
					<div class="userFriAvatat">
						<img src="images/act_commonHead_img.jpg" alt="头像" />
						<p>您的好友小明领取了一张28元免单券</p>
						<!--<div class="userFriInf">
							<p>您的好友小明领取了一张28元免单券</p>
						</div>-->
					</div>
					<!--<div class="userFriInf_wrap">
						<div class="userFriHbValue_wrap">
							<span class="userFriHbValue">7<span>元</span></span>
						</div>
					</div>-->
				</div>

				<!--<div class="friHbShow">
					<div class="userFriAvatat">
						<img src="images/act_commonHead_img.jpg" alt="头像" />
						<div class="userFriInf">
							<strong>小明 </strong>
							<p>人品爆发，这波福利我收啦!</p>
						</div>
					</div>
				</div>-->
			</div>
			<!--活动规则 start-->
			<div class="activeRuleShowWrap ">
				<!--<div class="comShowTitle">
					<img src="images/act_18allergyIndex_title.png" />
				</div>-->
				<div class="comShowTitle">
					<div class="leftLineDot">
						<span style="height: 1px; width: 1rem;"></span> 
						<!--<span style="width: 6px; height: 6px; transform: rotate(40deg); -o-transform: rotate(40deg); -webkit-transform: rotate(40deg); -moz-transform: rotate(40deg);"></span>-->
					</div>
					<div class="comshowTitleText">活动细则</div>
					<div class="rightLineDot">
						<!--<span style="width: 6px; height: 6px; transform: rotate(40deg); -o-transform: rotate(40deg); -webkit-transform: rotate(40deg); -moz-transform: rotate(40deg);"></span>--> 
						<span style="height: 1px; width: 1rem;"></span>
					</div>
				</div>
				<div class="activeRuleShow">
					<p>1.新用户注册下载app即可获得28元免单券一张，在我的优惠券中查看（有效期30天)。</span></p>
					<p>2.老用户邀请一位新用户注册下载app，并且新用户下单后成功签收（包含使用28元免单券下单），老用户即可获得28元免单券一张，在我的优惠券中查看（有效期30天)。</p>
					<p>3.8.同一设备只可绑定同一手机号，其他手机号无法使用。</p>
				</div>
			</div>
			<!--活动规则 end-->
		</div>
		<!--<%@ include file="act_common_sharePage.jsp"%>-->
	</body>
	<script>
		
		var phoneNum = '${phoneNum}';
		var fromUserId = '${user_id}';
		var wechatObj = new Object();
		//alert(location.href);
	
		window.onload = function() {
			$(".getHbWrap").on("click", "#getHbBtn", function() {
				waitShow();
				$_phoneno = $("#userPhone").val();
				var regno = /1[3-8]+\d{9}/;
				if ($_phoneno == "" || $_phoneno == "请输入手机号码" || !regno.test($_phoneno)) {
					waitClose();
					alert("请输入正确的手机号码")
					return false
				};
				var phone_num = $('#userPhone').val();
				$.ajax({
					type : "post",
					url : "couponActR",
					data : "phoneNum=" + $_phoneno+ "&code_act_id=" + codeActId,
					success : function(result) {
						console.debug("result");
						waitClose();
						$("#userPhone").val("");
						if (result.result == "succ") {
							console.log("succ");
							$(".commomLogin").hide();
							$(".received_result").show();
							$(".receive_success").show();
						} else if (result.result == "fail") {
							if (result.data.msg == "received") {
								console.log("received");
								$(".commomLogin").hide();
								$(".received_result").show();
								$(".has_received").show();
							}else if(result.data.empty == 'sendout'){
								console.debug('已经抢光了') ;
								//已经抢光了
								$(".commomLogin").hide();
								$(".received_result").show();
							}else if(result.data.empty == 'actEnd'){
								console.debug('活动结束') ;
								//跳到活动结束页
								window.location.href= "actEnd.html"
							}else {
								alert(result.data.msg);
								waitClose();
							}
						}
					},
					error : function() {
						alert("发送请求失败");
						waitClose();
					}
				});
			});
			//分享
			$(".getHbWrap").on("click", ".shareForFri", function() {
				$("#shareshade").css("height", $(".content").height());
				$("#shareshade").show();
			});
		}
	</script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script>
		wechatObj.title = '【药快到】免费送你3M口罩，先到先得~';
		wechatObj.desc = '春季防敏防霾 “罩”护你健康';
		wechatObj.link = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=' + appid + '&redirect_uri=' + redirect_uri + '&response_type=code&scope=snsapi_base&state={"silent_grant ":"yes","from_user_id":"' + fromUserId + '"}#wechat_redirect';
		wechatObj.imgUrl = 'http://imgstore.camore.cn/icon/logo/act_18allergyIndex_shareImg.jpg';
	
		if (is_weixin()) {
			$.ajax({
				url : "/medhtml/common/getwxjssign?",
				data : {
					url : location.href.split('#')[0]
				},
				success : function(wechatReturn) {
					if (wechatReturn) {
						wx.config({
							debug : false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
							appId : appid, // 必填，公众号的唯一标识
							timestamp : wechatReturn.timestamp, // 必填，生成签名的时间戳
							nonceStr : wechatReturn.nonceStr, // 必填，生成签名的随机串
							signature : wechatReturn.signature,// 必填，签名，见附录1
							jsApiList : [ "onMenuShareTimeline", "onMenuShareAppMessage", "onMenuShareQQ", "onMenuShareWeibo" ]
						// 必填，需要使用的JS接口列表，所有JS接口列表见附录2
						});
					}
					;
					wx.ready(function() {
						getMenuShare();
					});
				}
			});
		};
		wx.ready(function() {
			getWechatObj()
		})
		function getWechatObj() {
			wx.onMenuShareTimeline({
				title : wechatObj.desc, // 分享描述
				link : wechatObj.link, // 分享链接
				imgUrl : wechatObj.imgUrl, // 分享图标
				success : function() {
				},
				cancel : function() {
				}
			});
			wx.onMenuShareAppMessage({
				title : wechatObj.title, // 分享标题
				desc : wechatObj.desc, // 分享描述
				link : wechatObj.link, // 分享链接
				imgUrl : wechatObj.imgUrl, // 分享图标
				success : function() {
				},
				cancel : function() {
				}
			});
			wx.onMenuShareQQ({
				title : wechatObj.title, // 分享标题
				desc : wechatObj.desc, // 分享描述
				link : wechatObj.link, // 分享链接
				imgUrl : wechatObj.imgUrl, // 分享图标
				success : function() {
				},
				cancel : function() {
				}
			});
			wx.onMenuShareWeibo({
				title : wechatObj.title, // 分享标题
				desc : wechatObj.desc, // 分享描述
				link : wechatObj.link, // 分享链接
				imgUrl : wechatObj.imgUrl, // 分享图标
				success : function() {
				},
				cancel : function() {
				}
			});
		}
	</script>

</html>